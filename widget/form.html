<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Spreadsheet Cloud API shortcode generator</title>
        <script type="text/javascript" src="/wp-includes/js/jquery/jquery.js"></script>
        <script type="text/javascript" src="/wp-includes/js/tinymce/tiny_mce_popup.js"></script>
        <link rel="stylesheet" type="text/css" href="formstyle.css" />
    </head>

    <body>

        <script type="text/javascript">
            jQuery(function ($) {
                $.get("getfilelist.php", function (htmlFilesList) {
                    $(".filelist").append(htmlFilesList);
                    $("#sclapi-container").append($("#sclapi-container-template").find("fieldset").clone(false));
                    CommandChangeCore($("#sclapi-container").find("fieldset").find(".command"));
                });
                $('body').on('change', '.range', rangeChange);
                $('body').on('change', '.command', commandChange);
                $('body').on('change', '.examplecommand', exampleCommandChange);

                $(document).ready(function () {
                    $("#insert").click(function () {
                        var shortcode = "[";
                        $("form #sclapi-container").find("input:not(:disabled), select:not(:disabled)").each(function () {
                            var att_name = $(this).attr("name"),
                               att_value = $(this).val(),
                               att_result = '';
                            if (att_name == "exportgridlines") {
                                if ($(this).prop("checked"))
                                    att_value = "true";
                                else att_value = undefined;
                            }
                            if (att_value != undefined && att_value.length != 0 && att_name != "shortcode")
                                att_result = att_name + '="' + att_value + '" ';
                            if (att_name == "shortcode") {
                                if (shortcode.length > 1) {
                                    shortcode += "]<br />["
                                }
                                att_result = att_value;
                            }
                            shortcode += att_result;
                        })
                        shortcode += ']';

                        tinyMCEPopup.editor.execCommand('mceInsertContent', false, shortcode);
                        tinyMCEPopup.close();
                    })
                    $("#create_example").click(function () {
                        output = $("#example-container-template").find("fieldset").clone(false);
                        $("#sclapi-container").append(output);
                        CommandChangeCore($("#sclapi-container").find("fieldset").find(".examplecommand"));
                    })

                    $("#add_shortcode").click(function () {
                        output = $("#sclapi-container-template").find("fieldset").clone(false);
                        $("#sclapi-container").append(output);
                        CommandChangeCore($("#sclapi-container").find("fieldset").find(".command"));
                    })

                    $("#cancel").click(function () {
                        tinyMCEPopup.close();
                    })
                })
                function rangeChange() {
                    var range = $(this);
                    var form = range.closest("fieldset");
                    disableIndexParameters(form, range.val().length > 0);
                }
                function commandChange() {
                    var command = $(this);
                    CommandChangeCore(command);
                }
                function CommandChangeCore(command) {
                    disableCommandParameters(command.closest("fieldset"), command.val() == "GetHTMLRange");
                }
                function disableCommandParameters(form, disabled) {
                    form.find(".exportgridlines").attr('disabled', !disabled);
                    form.find(".imggrouppar").find("input, select").each(function () {
                        $(this).attr('disabled', disabled);
                    })
                }
                function disableIndexParameters(form, disabled) {
                    form.find(".startrowindex").attr('disabled', disabled);
                    form.find(".endrowindex").attr('disabled', disabled);
                    form.find(".startcolumnindex").attr('disabled', disabled);
                    form.find(".endcolumnindex").attr('disabled', disabled);
                }
                function exampleCommandChange() {
                    var command = $(this);
                    CommandChangeCore(command);
                    var sheetindex = command.closest("fieldset").find(".sheet").find(".sheetindex");
                    if (command.val() == "GetHTMLRange") {
                        sheetindex.val(0);
                    }
                    else {
                        sheetindex.val(1);
                    }
                }
            })

        </script>
        <form id="sclapi-generator">
            <div id="sclapi-container">
            </div>
            <div>
                <input type="button" id="create_example" name="create_example" value="Create example" class="mceButton" style="float:right" />
                <input type="button" id="add_shortcode" name="add_shortcode" value=" + " class="mceButton" />
                <input type="button" id="insert" name="insert" value="Insert" />
                <input type="button" id="cancel" name="cancel" value="Cancel" />
            </div>
        </form>
        <div id="sclapi-container-template" style="display:none">
            <fieldset>
                <legend>Shortcode parameters</legend>
                <input type="hidden" class="shortcode" name="shortcode" value="sclapi ">
                <span>Command: </span><select class="command" name="command">
                    <option value="GetHTMLRange">GetHTMLRange</option>
                    <option>GetImage</option>
                    <option>GetImageBytes</option>
                </select><br />
                <div class="filelist"></div>
                <div class="sheet">
                    <span>Sheet Name: </span><input type="text" class="sheetname" name="sheetname" />
                    <span> Sheet Index: </span><input type="number" class="sheetindex" name="sheetindex" value="0"/><br />
                </div>
                <div class="rangegrouppar"><span>Range: </span><input type="text" class="range" name="range" /><br />
                    <span>Start Row Index: </span><input type="number" class="startrowindex" name="startrowindex" />
                    <span> End Row Index: </span><input type="number" class="endrowindex" name="endrowindex" /><br />
                    <span>Start Column Index: </span><input type="number" class="startcolumnindex" name="startcolumnindex" />
                    <span> End Column Index: </span><input type="number" class="endcolumnindex" name="endcolumnindex" /><br /></div>
                <div class="htmlgrouppar">
                    <span style="vertical-align: top">Export Grid Lines: </span><input type="checkbox" class="exportgridlines" name="exportgridlines" style="vertical-align: top" /><br /></div>
                <div class="imggrouppar"><span>Object Index: </span><input type="number" class="objectindex" name="objectindex" value="0" /><br />
                    <span>Picture Type: </span><select class="picturetype" name="picturetype">
                        <option>picture</option>
                        <option>chart</option>
                    </select><br />
                    <span>Height: </span><input type="number" class="height" name="height" />
                    <span> Width: </span><input type="number" class="width" name="width" /></div>
            </fieldset>
        </div>
        <div id="example-container-template" style="display:none">
            <fieldset>
                <legend>Example shortcode parameters</legend>
                <input type="hidden" class="shortcode" name="shortcode" value="sclapiexample ">
                <span>Command: </span><select class="examplecommand" name="command">
                    <option value="GetHTMLRange">GetHTMLRange</option>
                    <option>GetImage</option>
                    <option>GetImageBytes</option>
                </select><br />
                <div class="examplefiles">
                    <span>File Name: </span>
                    <select class="examplefilename" name="filename" size="1">
                        <option value="example.xlsx">example.xlsx</option>
                    </select><br />
                </div>
                <div class="sheet">
                    <span>Sheet Name: </span><input type="text" class="sheetname" name="sheetname" readonly="readonly"/>
                    <span> Sheet Index: </span><input type="number" class="sheetindex" name="sheetindex" value="0" readonly="readonly"/><br />
                </div>
                <div class="rangegrouppar"><span>Range: </span><input type="text" class="range" name="range" value="A1:E7" readonly="readonly"/><br />
                    <span>Start Row Index: </span><input type="number" class="startrowindex" name="startrowindex" readonly="readonly"/>
                    <span> End Row Index: </span><input type="number" class="endrowindex" name="endrowindex" readonly="readonly"/><br />
                    <span>Start Column Index: </span><input type="number" class="startcolumnindex" name="startcolumnindex" readonly="readonly"/>
                    <span> End Column Index: </span><input type="number" class="endcolumnindex" name="endcolumnindex" readonly="readonly"/><br /></div>
                <div class="htmlgrouppar">
                    <span style="vertical-align: top">Export Grid Lines: </span><input type="checkbox" class="exportgridlines" name="exportgridlines" style="vertical-align: top" /><br />
                </div>
                <div class="imggrouppar"><span>Object Index: </span><input type="number" class="objectindex" name="objectindex" value="0" /><br />
                    <span>Picture Type: </span><select class="picturetype" name="picturetype">
                        <option>picture</option>
                        <option>chart</option>
                    </select><br />
                    <span>Height: </span><input type="number" class="height" name="height" />
                    <span> Width: </span><input type="number" class="width" name="width" /></div>
            </fieldset>
        </div>
    </body>
</html>